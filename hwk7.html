<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- <link href="https://cdn.jsdelivr.net/npm/reset-css@5.0.2/reset.min.css" rel="stylesheet"> -->

    <link rel="stylesheet" href="style.css" />
    <title>Document</title>
  </head>
  <body>
    <section class="addTicket-panel">
      <div class="addTicket-img">
        <img
          src="https://github.com/hexschool/2022-web-layout-training/blob/main/js_week5/main_img.png?raw=true"
          alt=""
        />
        <img
          src="https://github.com/hexschool/2022-web-layout-training/blob/main/js_week5/logo.png?raw=true"
          alt=""
        />
      </div>
      <form action="" class="addTicket-form">
        <h1 class="title">
          <span><i class="fas fa-plus-circle"></i></span>新增旅遊套票
        </h1>
        <div class="form-group">
          <div class="addTicket-input">
            <label for="ticketName">套票名稱</label>
            <input
              type="text"
              id="ticketName"
              placeholder="請填寫套票名稱"
              name="套票名稱"
            />
          </div>
          <div class="alert-message">
            <p id="ticketName-message" data-message="套票名稱">
              <!--    <i class="fas fa-exclamation-circle"></i>
                        <span>必填!</span> -->
            </p>
          </div>
        </div>
        <div class="form-group">
          <div class="addTicket-input">
            <label for="ticketImgUrl">圖片網址</label>
            <input
              type="text"
              id="ticketImgUrl"
              placeholder="請填寫圖片網址"
              name="圖片網址"
            />
          </div>
          <div class="alert-message">
            <p id="ticketImgUrl-message" data-message="圖片網址">
              <!-- <i class="fas fa-exclamation-circle"></i>
                          <span>必填!</span> -->
            </p>
          </div>
        </div>
        <div class="form-group">
          <div class="addTicket-input">
            <label for="ticketRegion">景點地區</label>
            <select id="ticketRegion" name="景點地區">
              <option value="" disabled selected hidden>請選擇景點地區</option>
              <option value="台北">台北</option>
              <option value="台中">台中</option>
              <option value="高雄">高雄</option>
            </select>
          </div>
          <div class="alert-message">
            <p id="ticketRegion-message" data-message="景點地區">
              <!-- <i class="fas fa-exclamation-circle"></i>
                          <span>必填!</span> -->
            </p>
          </div>
        </div>
        <div class="form-group">
          <div class="addTicket-input">
            <label for="ticketPrice">套票金額</label>
            <input
              type="number"
              id="ticketPrice"
              placeholder="請填寫套票金額"
              name="套票金額"
              min="0"
            />
          </div>
          <div class="alert-message">
            <p id="ticketPrice-message" data-message="套票金額">
              <!-- <i class="fas fa-exclamation-circle"></i>
                          <span>必填!</span> -->
            </p>
          </div>
        </div>
        <div class="form-group">
          <div class="addTicket-input">
            <label for="ticketNum">套票組數</label>
            <input
              type="number"
              id="ticketNum"
              placeholder="請填寫套票組數"
              name="套票組數"
              min="1"
            />
          </div>
          <div class="alert-message">
            <p id="ticketNum-message" data-message="套票組數">
              <!-- <i class="fas fa-exclamation-circle"></i>
                          <span>必填!</span> -->
            </p>
          </div>
        </div>
        <div class="form-group">
          <div class="addTicket-input">
            <label for="ticketRate">套票星級</label>
            <input
              type="number"
              id="ticketRate"
              placeholder="請填寫套票星級"
              name="套票星級"
              min="1"
              max="10"
            />
          </div>
          <div class="alert-message">
            <p id="ticketRate-message" data-message="套票星級">
              <!-- <i class="fas fa-exclamation-circle"></i>
                          <span>必填!</span> -->
            </p>
          </div>
        </div>
        <div class="form-group">
          <div class="addTicket-input">
            <label for="ticketDescription">套票描述</label>
            <textarea
              name="套票描述"
              id="ticketDescription"
              placeholder="請填寫套票描述 (限 100 字)"
            ></textarea>
          </div>
          <div class="alert-message">
            <p id="ticketDescription-message" data-message="套票描述">
              <!-- <i class="fas fa-exclamation-circle"></i>
                          <span>必填!</span> -->
            </p>
          </div>
        </div>
        <input type="button" class="addTicket-btn btn" value="新增套票" />
      </form>
    </section>
    <section class="main-content">
      <!-- 搜尋區 -->
      <div class="search-area">
        <select name="" class="regionSearch">
          <option value="地區搜尋" disabled selected hidden>地區搜尋</option>
          <option value="">全部地區</option>
          <option value="台北">台北</option>
          <option value="台中">台中</option>
          <option value="高雄">高雄</option>
        </select>
        <p id="searchResult-text">本次搜尋共 筆資料</p>
        <div id="chart"></div>
      </div>
      <!-- 套票卡片區 -->
      <ul class="ticketCard-area">
        <li class="ticketCard">
          <div class="ticketCard-img">
            <a href="#">
              <img
                src="https://github.com/hexschool/2022-web-layout-training/blob/main/js_week5/travel_1.png?raw=true"
                alt=""
              />
            </a>
            <div class="ticketCard-region"></div>
            <div class="ticketCard-rank"></div>
          </div>
          <div class="ticketCard-content">
            <div>
              <h3>
                <a href="#" class="ticketCard-name"></a>
              </h3>
              <p class="ticketCard-description"></p>
            </div>
            <div class="ticketCard-info">
              <p class="ticketCard-num">
                <span><i class="fas fa-exclamation-circle"></i></span>
                剩下最後 <span id="ticketCard-num"> </span> 組
              </p>
              <p class="ticketCard-price">
                TWD <span id="ticketCard-price"></span>
              </p>
            </div>
          </div>
        </li>
        <li class="ticketCard">
          <div class="ticketCard-img">
            <a href="#">
              <img
                src="https://github.com/hexschool/2022-web-layout-training/blob/main/js_week5/travel_4.png?raw=true"
                alt=""
              />
            </a>
            <div class="ticketCard-region">台北</div>
            <div class="ticketCard-rank">2</div>
          </div>
          <div class="ticketCard-content">
            <div>
              <h3>
                <a href="#" class="ticketCard-name">清境高空觀景步道</a>
              </h3>
              <p class="ticketCard-description">
                清境農場青青草原數十公頃碧草，這些景觀豐沛了清境觀景步道的風格，也涵養它無可取代的特色。
              </p>
            </div>
            <div class="ticketCard-info">
              <div class="ticketCard-num">
                <p>
                  <span><i class="fas fa-exclamation-circle"></i></span>
                  剩下最後 <span id="ticketCard-num"> 99 </span> 組
                </p>
              </div>
              <p class="ticketCard-price">
                TWD <span id="ticketCard-price">$240</span>
              </p>
            </div>
          </div>
        </li>
        <li class="ticketCard">
          <div class="ticketCard-img">
            <a href="#">
              <img
                src="https://github.com/hexschool/2022-web-layout-training/blob/main/js_week5/travel_3.png?raw=true"
                alt=""
              />
            </a>
            <div class="ticketCard-region">台中</div>
            <div class="ticketCard-rank">7</div>
          </div>
          <div class="ticketCard-content">
            <div>
              <h3>
                <a href="#" class="ticketCard-name">山林悠遊套票</a>
              </h3>
              <p class="ticketCard-description">
                山林悠遊套票，結合南投清境高空步道、雙龍瀑布七彩吊橋、瑞龍瀑布園區之熱門景點。
              </p>
            </div>
            <div class="ticketCard-info">
              <div class="ticketCard-num">
                <p>
                  <span><i class="fas fa-exclamation-circle"></i></span>
                  剩下最後 <span id="ticketCard-num"> 20 </span> 組
                </p>
              </div>
              <p class="ticketCard-price">
                TWD <span id="ticketCard-price">$1765</span>
              </p>
            </div>
          </div>
        </li>
      </ul>
      <!-- 查無關鍵字區 -->
      <div class="cantFind-area">
        <h3>查無此關鍵字資料</h3>
        <img
          src="https://github.com/hexschool/2022-web-layout-training/blob/main/js_week5/no_found.png?raw=true"
          alt=""
        />
      </div>
    </section>
  </body>

  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.7.18/c3.css"
  />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.16.0/d3.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.7.18/c3.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
  <script>
    let data = [];
    let areaData = {};

    axios
      .get(
        "https://raw.githubusercontent.com/hexschool/js-training/main/travelApi.json"
      )
      .then(function (response) {
        data = response.data;
        console.log(response);
        init();
      })
      .catch(function (error) {
        console.log(error);
      });

    function init() {
      const list = document.querySelector(".ticketCard-area");
      list.innerHTML = "";
      const totalfilterNum = document.querySelector("#searchResult-text");
      totalfilterNum.innerHTML = `本次搜尋共 ${data.data.length} 筆資料`;
      data.data.forEach(function (item, index) {
        // 計算圖表區域數量
        if (areaData[item.area]) {
          areaData[item.area]++;
        } else {
          areaData[item.area] = 1;
        }
        //列出card
        let content = `<li class="ticketCard">
          <div class="ticketCard-img">
            <a href="#">
              <img
                src=${item.imgUrl}
                alt=""
              />
            </a>
            <div class="ticketCard-region">${item.area}</div>
            <div class="ticketCard-rank">${item.rate}</div>
          </div>
          <div class="ticketCard-content">
            <div>
              <h3>
                <a href="#" class="ticketCard-name">${item.name}</a>
              </h3>
              <p class="ticketCard-description">
                ${item.description}
              </p>
            </div>
            <div class="ticketCard-info">
              <p class="ticketCard-num">
                <span><i class="fas fa-exclamation-circle"></i></span>
                剩下最後 <span id="ticketCard-num"> ${item.group} </span> 組
              </p>
              <p class="ticketCard-price">
                TWD <span id="ticketCard-price">$${item.price}</span>
              </p>
            </div>
          </div>
        </li>`;

        list.innerHTML += content;
      });
      //讀取圖表區域數量
      updateDonutChart();
    }

    // 新增一個函數來更新 donut 圖表
    function updateDonutChart(){
      var chart = c3.generate({
      data: {
        columns:Object.entries(areaData),
        type: "donut",
        // onclick: function (d, i) {
        //   console.log("onclick", d);
        // },

      },
      donut: {
        title: "套票地區比重",
        width: 20,
        label: { show: false },
      },
    });

    }

    const regionfilter = document.querySelector(".regionSearch");

    regionfilter.addEventListener("click", function (e) {
      const list = document.querySelector(".ticketCard-area");
      list.innerHTML = "";
      let totalNum = 0;
      data.data.forEach(function (item, index) {
        if (e.target.value == "地區搜尋") {
          init();
        }
        if (e.target.value == "") {
          init();
        }
        if (e.target.value == item.area) {
          const totalfilterNum = document.querySelector("#searchResult-text");
          totalNum += 1;
          totalfilterNum.innerHTML = `本次搜尋共 ${totalNum} 筆資料`;
          let content = `<li class="ticketCard">
          <div class="ticketCard-img">
            <a href="#">
              <img
                src=${item.imgUrl}
                alt=""
              />
            </a>
            <div class="ticketCard-region">${item.area}</div>
            <div class="ticketCard-rank">${item.rate}</div>
          </div>
          <div class="ticketCard-content">
            <div>
              <h3>
                <a href="#" class="ticketCard-name">${item.name}</a>
              </h3>
              <p class="ticketCard-description">
                ${item.description}
              </p>
            </div>
            <div class="ticketCard-info">
              <p class="ticketCard-num">
                <span><i class="fas fa-exclamation-circle"></i></span>
                剩下最後 <span id="ticketCard-num"> ${item.group} </span> 組
              </p>
              <p class="ticketCard-price">
                TWD <span id="ticketCard-price">$${item.price}</span>
              </p>
            </div>
          </div>
        </li>`;

          list.innerHTML += content;
        }
      });
    });

    let addTicketBtn = document.querySelector(".addTicket-btn");
    let ticketName = document.querySelector("#ticketName");
    let ticketImgUrl = document.querySelector("#ticketImgUrl");
    let ticketRegion = document.querySelector("#ticketRegion");
    let ticketPrice = document.querySelector("#ticketPrice");
    let ticketGroup = document.querySelector("#ticketNum");
    let ticketRate = document.querySelector("#ticketRate ");
    let ticketDescription = document.querySelector("#ticketDescription ");
    addTicketBtn.addEventListener("click", function () {
      let newTicket = {};
      newTicket.id = data.length;
      newTicket.name = ticketName.value;
      newTicket.imgUrl = ticketImgUrl.value;
      newTicket.area = ticketRegion.value;
      newTicket.price = ticketPrice.value;
      newTicket.group = ticketNum.value;
      newTicket.rate = ticketRate.value;
      newTicket.description = ticketDescription.value;
      data.data.push(newTicket);

      init();
    });


  </script>
</html>
